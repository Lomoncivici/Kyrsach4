{% extends 'employees/admin/admin_base.html' %}

{% block title %}–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏{% endblock %}
{% block page_title %}‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: {{ user.login }}{% endblock %}

{% block admin_nav %}
{{ block.super }}
<a href="{% url 'admin_users_list' %}" 
   {% if request.resolver_match.url_name == 'admin_users_list' %}class="active"{% endif %}>
   üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
</a>
<a href="{% url 'admin_employees_list' %}" 
   {% if request.resolver_match.url_name == 'admin_employees_list' %}class="active"{% endif %}>
   üë®‚Äçüíº –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏
</a>
{% endblock %}

{% block content %}
<div class="content-box">
    <h2>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: {{ user.login }}</h2>
    
    <div style="background: #f7fafc; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
        <h3 style="margin-top: 0;">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
            <div style="text-align: center;">
                <div style="font-size: 24px; font-weight: bold; color: #4a5568;">{{ user_stats.0 }}</div>
                <div style="font-size: 14px; color: #718096;">–ü–æ–∫—É–ø–∫–∏</div>
            </div>
            <div style="text-align: center;">
                <div style="font-size: 24px; font-weight: bold; color: #4a5568;">{{ user_stats.1 }}</div>
                <div style="font-size: 14px; color: #718096;">–ü–æ–¥–ø–∏—Å–∫–∏</div>
            </div>
            <div style="text-align: center;">
                <div style="font-size: 24px; font-weight: bold; color: #4a5568;">{{ user_stats.2 }}</div>
                <div style="font-size: 14px; color: #718096;">–ü—Ä–æ—Å–º–æ—Ç—Ä—ã</div>
            </div>
            <div style="text-align: center;">
                <div style="font-size: 24px; font-weight: bold; color: #4a5568;">{{ user_stats.3 }}</div>
                <div style="font-size: 14px; color: #718096;">–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</div>
            </div>
        </div>
    </div>
    
    <form method="post" style="max-width: 800px;">
        {% csrf_token %}
        
        <div class="form-row">
            <div class="form-group">
                <label for="email">Email *</label>
                <input type="email" id="email" name="email" required 
                       value="{{ user.email }}">
                <div style="font-size: 12px; color: #718096;">
                    –£–Ω–∏–∫–∞–ª—å–Ω—ã–π email –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                </div>
            </div>
            
            <div class="form-group">
                <label for="login">–õ–æ–≥–∏–Ω *</label>
                <input type="text" id="login" name="login" required 
                       value="{{ user.login }}">
                <div style="font-size: 12px; color: #718096;">
                    –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –ª–æ–≥–∏–Ω (5-32 —Å–∏–º–≤–æ–ª–∞)
                </div>
            </div>
        </div>
        
        <div class="form-group">
            <label for="password">–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å (–æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º, –µ—Å–ª–∏ –Ω–µ –Ω—É–∂–Ω–æ –º–µ–Ω—è—Ç—å)</label>
            <input type="password" id="password" name="password" 
                   placeholder="–ú–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤">
            <div style="font-size: 12px; color: #718096;">
                –ï—Å–ª–∏ —É–∫–∞–∑–∞—Ç—å –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å, —Å—Ç–∞—Ä—ã–π –±—É–¥–µ—Ç –∑–∞–º–µ–Ω—ë–Ω
            </div>
        </div>
        
        <div class="form-group">
            <label>–†–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
            <div style="background: #f7fafc; padding: 15px; border-radius: 8px; margin-top: 10px;">
                {% for role in all_roles %}
                <div class="checkbox-group" style="margin-bottom: 8px;">
                    <input type="checkbox" id="role_{{ role.0 }}" name="roles" value="{{ role.0 }}"
                           {% if role.0 in user_roles %}checked{% endif %}>
                    <label for="role_{{ role.0 }}">
                        <span style="font-weight: bold;">{{ role.1 }}</span> - {{ role.2 }}
                    </label>
                </div>
                {% endfor %}
            </div>
        </div>
        
        <div class="form-group">
            <label class="checkbox-group">
                <input type="checkbox" id="is_active" name="is_active" 
                       {% if user.is_active %}checked{% endif %}>
                <span>–ê–∫—Ç–∏–≤–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</span>
            </label>
        </div>
        
        <div class="form-group" style="margin-top: 30px;">
            <button type="submit" class="btn btn-success">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
            <a href="{% url 'admin_users_list' %}" class="btn" style="background: #a0aec0; margin-left: 10px;">–û—Ç–º–µ–Ω–∞</a>
            
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <a href="{% url 'admin_user_activity' user.id %}" class="btn" style="background: #4299e1;">
                    üìä –ü—Ä–æ—Å–º–æ—Ç—Ä –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
                </a>
                
                <button type="button" onclick="showResetPasswordModal()" class="btn" style="background: #ed8936;">
                    üîÑ –°–±—Ä–æ—Å–∏—Ç—å –ø–∞—Ä–æ–ª—å
                </button>
            </div>
        </div>
    </form>
</div>

<div id="resetPasswordModal" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 500px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h3 style="margin: 0;">–°–±—Ä–æ—Å –ø–∞—Ä–æ–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h3>
            <button type="button" onclick="closeModal('resetPasswordModal')" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #718096;">&times;</button>
        </div>
        
        <div style="margin-bottom: 20px;">
            <p>–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Å–±—Ä–æ—Å–∏—Ç—å –ø–∞—Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è <strong>{{ user.login }}</strong> ({{ user.email }})?</p>
            <p style="color: #718096; font-size: 14px;">
                –ü–æ—Å–ª–µ —Å–±—Ä–æ—Å–∞ –±—É–¥–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –Ω–æ–≤—ã–π —Å–ª—É—á–∞–π–Ω—ã–π –ø–∞—Ä–æ–ª—å, –∫–æ—Ç–æ—Ä—ã–π –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç —Å–æ–æ–±—â–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.
            </p>
        </div>
        
        <div style="display: flex; gap: 10px;">
            <form method="post" action="{% url 'admin_user_reset_password' user.id %}" style="flex: 1;">
                {% csrf_token %}
                <button type="submit" class="btn btn-danger" style="width: 100%;">–î–∞, —Å–±—Ä–æ—Å–∏—Ç—å –ø–∞—Ä–æ–ª—å</button>
            </form>
            <button type="button" onclick="closeModal('resetPasswordModal')" class="btn" 
                    style="background: #a0aec0; flex: 1;">–û—Ç–º–µ–Ω–∞</button>
        </div>
    </div>
</div>

<style>
.modal {
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.5);
    display: flex;
    align-items: center;
    justify-content: center;
}

.modal-content {
    background: white;
    padding: 25px;
    border-radius: 10px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.2);
}

.checkbox-group {
    display: flex;
    align-items: center;
    gap: 10px;
    cursor: pointer;
}

.checkbox-group input[type="checkbox"] {
    width: auto;
    margin: 0;
}

.alert {
    padding: 12px 16px;
    border-radius: 6px;
    margin-bottom: 20px;
}

.alert-info {
    background-color: #e6fffa;
    border: 1px solid #81e6d9;
    color: #234e52;
}
</style>

<script>
function showResetPasswordModal() {
    document.getElementById('resetPasswordModal').style.display = 'flex';
}

function closeModal(modalId) {
    document.getElementById(modalId).style.display = 'none';
}

document.addEventListener('DOMContentLoaded', function() {
    window.onclick = function(event) {
        const modal = document.getElementById('resetPasswordModal');
        if (event.target == modal) {
            closeModal('resetPasswordModal');
        }
    }

    document.addEventListener('keydown', function(event) {
        if (event.key === 'Escape') {
            closeModal('resetPasswordModal');
        }
    });
});
</script>
{% endblock %}