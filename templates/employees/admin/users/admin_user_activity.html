{% extends 'employees/admin/admin_base.html' %}

{% block title %}–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è - {{ user.login }}{% endblock %}
{% block page_title %}üìä –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: {{ user.login }}{% endblock %}

{% block admin_nav %}
{{ block.super }}
<a href="{% url 'admin_users_list' %}" 
   {% if request.resolver_match.url_name == 'admin_users_list' %}class="active"{% endif %}>
   üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
</a>
<a href="{% url 'admin_employees_list' %}" 
   {% if request.resolver_match.url_name == 'admin_employees_list' %}class="active"{% endif %}>
   üë®‚Äçüíº –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏
</a>
{% endblock %}

{% block content %}
<div class="content-box">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h2 style="margin: 0;">–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: {{ user.login }}</h2>
        <div style="display: flex; gap: 10px;">
            <a href="{% url 'admin_user_edit' user.id %}" class="btn" style="background: #4299e1;">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
            <a href="{% url 'admin_users_list' %}" class="btn" style="background: #a0aec0;">‚Üê –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É</a>
        </div>
    </div>

    <div style="background: #f7fafc; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
            <div>
                <div style="font-size: 14px; color: #718096;">Email</div>
                <div style="font-weight: bold;">{{ user.email }}</div>
            </div>
            <div>
                <div style="font-size: 14px; color: #718096;">–°—Ç–∞—Ç—É—Å</div>
                <div>
                    {% if user.is_active %}
                    <span class="badge" style="background: #48bb78;">–ê–∫—Ç–∏–≤–µ–Ω</span>
                    {% else %}
                    <span class="badge" style="background: #e53e3e;">–ù–µ–∞–∫—Ç–∏–≤–µ–Ω</span>
                    {% endif %}
                </div>
            </div>
            <div>
                <div style="font-size: 14px; color: #718096;">–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</div>
                <div>{{ user.created_at|date:"d.m.Y H:i" }}</div>
            </div>
            <div>
                <div style="font-size: 14px; color: #718096;">–†–æ–ª–∏</div>
                <div>
                    {% if user_roles %}
                        {% for role in user_roles %}
                        <span class="badge" style="background: #805ad5; margin-right: 5px;">{{ role.0 }}</span>
                        {% endfor %}
                    {% else %}
                    <span style="color: #a0aec0;">‚Äî</span>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 30px;">
        <div style="background: white; padding: 15px; border-radius: 8px; border: 1px solid #e2e8f0; text-align: center;">
            <div style="font-size: 24px; font-weight: bold; color: #4a5568;">{{ stats.0 }}</div>
            <div style="font-size: 14px; color: #718096;">–ü–æ–∫—É–ø–∫–∏</div>
        </div>
        <div style="background: white; padding: 15px; border-radius: 8px; border: 1px solid #e2e8f0; text-align: center;">
            <div style="font-size: 24px; font-weight: bold; color: #4a5568;">{{ stats.1 }}</div>
            <div style="font-size: 14px; color: #718096;">–ü–æ–¥–ø–∏—Å–∫–∏</div>
        </div>
        <div style="background: white; padding: 15px; border-radius: 8px; border: 1px solid #e2e8f0; text-align: center;">
            <div style="font-size: 24px; font-weight: bold; color: #4a5568;">{{ stats.2 }}</div>
            <div style="font-size: 14px; color: #718096;">–ü—Ä–æ—Å–º–æ—Ç—Ä—ã</div>
        </div>
        <div style="background: white; padding: 15px; border-radius: 8px; border: 1px solid #e2e8f0; text-align: center;">
            <div style="font-size: 24px; font-weight: bold; color: #4a5568;">{{ stats.3 }}</div>
            <div style="font-size: 14px; color: #718096;">–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</div>
        </div>
        <div style="background: white; padding: 15px; border-radius: 8px; border: 1px solid #e2e8f0; text-align: center;">
            <div style="font-size: 24px; font-weight: bold; color: #4a5568;">{{ stats.4 }}</div>
            <div style="font-size: 14px; color: #718096;">–í—ã—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ –æ—Ü–µ–Ω–æ–∫</div>
        </div>
        <div style="background: white; padding: 15px; border-radius: 8px; border: 1px solid #e2e8f0; text-align: center;">
            <div style="font-size: 24px; font-weight: bold; color: #4a5568;">{{ stats.6|floatformat:2 }} ‚ÇΩ</div>
            <div style="font-size: 14px; color: #718096;">–í—Å–µ–≥–æ –ø–æ—Ç—Ä–∞—á–µ–Ω–æ</div>
        </div>
    </div>
    
    <div style="margin-bottom: 20px;">
        <div style="display: flex; gap: 0; border-bottom: 2px solid #e2e8f0;">
            <button type="button" onclick="showTab('purchases')" id="purchasesTab" 
                    style="padding: 10px 20px; background: #f7fafc; border: none; border-bottom: 2px solid #4299e1; cursor: pointer; font-weight: bold;">
                üõí –ü–æ–∫—É–ø–∫–∏ ({{ purchases|length }})
            </button>
            <button type="button" onclick="showTab('subscriptions')" id="subscriptionsTab" 
                    style="padding: 10px 20px; background: #f7fafc; border: none; cursor: pointer;">
                üìä –ü–æ–¥–ø–∏—Å–∫–∏ ({{ subscriptions|length }})
            </button>
            <button type="button" onclick="showTab('watch_history')" id="watchHistoryTab" 
                    style="padding: 10px 20px; background: #f7fafc; border: none; cursor: pointer;">
                üì∫ –ü—Ä–æ—Å–º–æ—Ç—Ä—ã ({{ watch_history|length }})
            </button>
            <button type="button" onclick="showTab('favorites')" id="favoritesTab" 
                    style="padding: 10px 20px; background: #f7fafc; border: none; cursor: pointer;">
                ‚≠ê –ò–∑–±—Ä–∞–Ω–Ω–æ–µ ({{ favorites|length }})
            </button>
        </div>
    </div>
    
    <div id="purchasesContent" class="tab-content">
        <h3>–ò—Å—Ç–æ—Ä–∏—è –ø–æ–∫—É–ø–æ–∫</h3>
        {% if purchases %}
        <div style="overflow-x: auto;">
            <table>
                <thead>
                    <tr>
                        <th>–ö–æ–Ω—Ç–µ–Ω—Ç</th>
                        <th>–¢–∏–ø</th>
                        <th>–¶–µ–Ω–∞</th>
                        <th>–î–∞—Ç–∞ –ø–æ–∫—É–ø–∫–∏</th>
                    </tr>
                </thead>
                <tbody>
                    {% for purchase in purchases %}
                    <tr>
                        <td>
                            <strong>{{ purchase.0 }}</strong>
                        </td>
                        <td>
                            {% if purchase.1 == 'movie' %}
                            <span class="badge" style="background: #4299e1;">–§–∏–ª—å–º</span>
                            {% else %}
                            <span class="badge" style="background: #ed8936;">–°–µ—Ä–∏–∞–ª</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if purchase.3 == '–ë–µ—Å–ø–ª–∞—Ç–Ω–æ' %}
                            <span class="badge" style="background: #48bb78;">–ë–µ—Å–ø–ª–∞—Ç–Ω–æ</span>
                            {% else %}
                            {{ purchase.2 }} ‚ÇΩ
                            {% endif %}
                        </td>
                        <td>
                            {{ purchase.4|date:"d.m.Y H:i" }}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <p style="text-align: center; color: #718096; padding: 20px;">–ù–µ—Ç –ø–æ–∫—É–ø–æ–∫</p>
        {% endif %}
    </div>
    
    <div id="subscriptionsContent" class="tab-content" style="display: none;">
        <h3>–ò—Å—Ç–æ—Ä–∏—è –ø–æ–¥–ø–∏—Å–æ–∫</h3>
        {% if subscriptions %}
        <div style="overflow-x: auto;">
            <table>
                <thead>
                    <tr>
                        <th>–¢–∞—Ä–∏—Ñ</th>
                        <th>–°—Ç–∞—Ç—É—Å</th>
                        <th>–ù–∞—á–∞–ª–æ</th>
                        <th>–û–∫–æ–Ω—á–∞–Ω–∏–µ</th>
                        <th>–û–ø–ª–∞—Ç–∞</th>
                    </tr>
                </thead>
                <tbody>
                    {% for sub in subscriptions %}
                    <tr>
                        <td>
                            <strong>{{ sub.0 }}</strong>
                            <div style="font-size: 12px; color: #718096;">{{ sub.1 }}</div>
                        </td>
                        <td>
                            {% if sub.2 == 'active' %}
                            <span class="badge" style="background: #48bb78;">–ê–∫—Ç–∏–≤–Ω–∞</span>
                            {% elif sub.2 == 'cancelled' %}
                            <span class="badge" style="background: #a0aec0;">–û—Ç–º–µ–Ω–µ–Ω–∞</span>
                            {% elif sub.2 == 'expired' %}
                            <span class="badge" style="background: #e53e3e;">–ò—Å—Ç–µ–∫–ª–∞</span>
                            {% else %}
                            <span class="badge" style="background: #ed8936;">{{ sub.2 }}</span>
                            {% endif %}
                        </td>
                        <td>{{ sub.3|date:"d.m.Y" }}</td>
                        <td>
                            {% if sub.4 %}
                            {{ sub.4|date:"d.m.Y" }}
                            {% else %}
                            <span style="color: #a0aec0;">‚Äî</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if sub.5 %}
                            {{ sub.5 }} ‚ÇΩ
                            <div style="font-size: 12px; color: #718096;">
                                {{ sub.6 }}
                            </div>
                            {% else %}
                            <span style="color: #a0aec0;">‚Äî</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <p style="text-align: center; color: #718096; padding: 20px;">–ù–µ—Ç –ø–æ–¥–ø–∏—Å–æ–∫</p>
        {% endif %}
    </div>
    
    <div id="watchHistoryContent" class="tab-content" style="display: none;">
        <h3>–ò—Å—Ç–æ—Ä–∏—è –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤</h3>

        {% if watch_history %}
        <div style="overflow-x: auto;">
            <table>
                <thead>
                    <tr>
                        <th>–ö–æ–Ω—Ç–µ–Ω—Ç</th>
                        <th>–î–∞—Ç–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞</th>
                    </tr>
                </thead>
                <tbody>
                    {% for watch in watch_history %}
                    <tr>
                        <td>
                            <strong>{{ watch.0 }}</strong>
                            <div style="font-size: 12px; color: #718096;">
                                {% if watch.1 == 'movie' %}
                                –§–∏–ª—å–º
                                {% else %}
                                –°–µ—Ä–∏–∞–ª
                                {% endif %}
                            </div>
                        </td>
                        <td>{{ watch.2|date:"d.m.Y H:i" }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <p style="text-align: center; color: #718096; padding: 20px;">–ù–µ—Ç –∏—Å—Ç–æ—Ä–∏–∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤</p>
        {% endif %}
    </div>
    
    <div id="favoritesContent" class="tab-content" style="display: none;">
        <h3>–ò–∑–±—Ä–∞–Ω–Ω–æ–µ</h3>
        {% if favorites %}
        <div style="overflow-x: auto;">
            <table>
                <thead>
                    <tr>
                        <th>–ö–æ–Ω—Ç–µ–Ω—Ç</th>
                        <th>–¢–∏–ø</th>
                        <th>–î–∞—Ç–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è</th>
                    </tr>
                </thead>
                <tbody>
                    {% for fav in favorites %}
                    <tr>
                        <td>
                            <strong>{{ fav.0 }}</strong>
                        </td>
                        <td>
                            {% if fav.1 == 'movie' %}
                            <span class="badge" style="background: #4299e1;">–§–∏–ª—å–º</span>
                            {% else %}
                            <span class="badge" style="background: #ed8936;">–°–µ—Ä–∏–∞–ª</span>
                            {% endif %}
                        </td>
                        <td>{{ fav.2|date:"d.m.Y H:i" }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <p style="text-align: center; color: #718096; padding: 20px;">–ù–µ—Ç –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ</p>
        {% endif %}
    </div>
</div>

<style>
.tab-content {
    padding: 20px 0;
}

.badge {
    display: inline-block;
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 12px;
    font-weight: 600;
    color: white;
}

table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
}

th {
    background: #f7fafc;
    padding: 12px;
    text-align: left;
    border-bottom: 2px solid #e2e8f0;
    color: #4a5568;
    font-weight: 600;
}

td {
    padding: 12px;
    border-bottom: 1px solid #e2e8f0;
}

tr:hover {
    background: #fafafa;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    showTab('purchases');
});

function showTab(tabName) {
    let contentId = tabName + 'Content';

    if (tabName === 'watch_history') {
        contentId = 'watchHistoryContent';
        tabName = 'watchHistory';
    }
    
    console.log('–ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–∞–±:', tabName, 'ID –∫–æ–Ω—Ç–µ–Ω—Ç–∞:', contentId);

    const contents = document.querySelectorAll('.tab-content');
    contents.forEach(content => {
        content.style.display = 'none';
    });
    
    const tabs = ['purchasesTab', 'subscriptionsTab', 'watchHistoryTab', 'favoritesTab'];
    tabs.forEach(tabId => {
        const tab = document.getElementById(tabId);
        if (tab) {
            tab.style.borderBottom = 'none';
            tab.style.fontWeight = 'normal';
            tab.style.background = '#f7fafc';
        }
    });
    
    const content = document.getElementById(contentId);
    if (content) {
        content.style.display = 'block';
    } else {
        console.error('–ö–æ–Ω—Ç–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω:', contentId);
    }
    
    const selectedTab = document.getElementById(tabName + 'Tab');
    if (selectedTab) {
        selectedTab.style.borderBottom = '2px solid #4299e1';
        selectedTab.style.fontWeight = 'bold';
        selectedTab.style.background = 'white';
    }
}
</script>
{% endblock %}