{% extends 'employees/admin/admin_base.html' %}

{% block title %}–í—ã–¥–∞—Ç—å –ø–æ–¥–ø–∏—Å–∫—É - –ü–æ–¥–ø–∏—Å–∫–∏{% endblock %}
{% block page_title %}üéÅ –í—ã–¥–∞—Ç—å –ø–æ–¥–ø–∏—Å–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é{% endblock %}

{% block admin_nav %}
{{ block.super }}
<a href="{% url 'admin_subscriptions' %}" 
   {% if request.resolver_match.url_name == 'admin_subscriptions' %}class="active"{% endif %}>
   üí∞ –¢–∞—Ä–∏—Ñ–Ω—ã–µ –ø–ª–∞–Ω—ã
</a>
<a href="{% url 'admin_user_subscriptions' %}" 
   {% if request.resolver_match.url_name == 'admin_user_subscriptions' %}class="active"{% endif %}>
   üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏
</a>
<a href="{% url 'admin_payments' %}" 
   {% if request.resolver_match.url_name == 'admin_payments' %}class="active"{% endif %}>
   üí≥ –ü–ª–∞—Ç–µ–∂–∏
</a>
{% endblock %}

{% block content %}
<div class="content-box">
    <h2>–í—ã–¥–∞—á–∞ –ø–æ–¥–ø–∏—Å–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é</h2>
    
    <form method="post" style="max-width: 800px;">
        {% csrf_token %}
        
        <div class="form-row">
            <div class="form-group">
                <label for="user_id">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å *</label>
                <select id="user_id" name="user_id" required style="width: 100%; padding: 10px;">
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è...</option>
                    {% for user in users %}
                    <option value="{{ user.0 }}">{{ user.1 }} ({{ user.2 }})</option>
                    {% endfor %}
                </select>
                <div style="font-size: 12px; color: #718096;">
                    –¢–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
                </div>
            </div>
            
            <div class="form-group">
                <label for="plan_id">–¢–∞—Ä–∏—Ñ–Ω—ã–π –ø–ª–∞–Ω *</label>
                <select id="plan_id" name="plan_id" required style="width: 100%; padding: 10px;">
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∞—Ä–∏—Ñ–Ω—ã–π –ø–ª–∞–Ω...</option>
                    {% for plan in plans %}
                    <option value="{{ plan.0 }}" 
                            data-price="{{ plan.3 }}"
                            data-period="{{ plan.4 }}">
                        {{ plan.1 }} - {{ plan.3 }} ‚ÇΩ ({{ plan.4 }} –º–µ—Å.)
                    </option>
                    {% endfor %}
                </select>
            </div>
        </div>
        
        <div class="form-row">
            <div class="form-group">
                <label for="start_date">–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞</label>
                <input type="date" id="start_date" name="start_date" 
                       value="{{ today|date:'Y-m-d' }}">
                <div style="font-size: 12px; color: #718096;">
                    –ï—Å–ª–∏ –ø—É—Å—Ç–æ, –Ω–∞—á–Ω–µ—Ç—Å—è —Å–µ–≥–æ–¥–Ω—è
                </div>
            </div>
            
            <div class="form-group">
                <label for="status">–°—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–∫–∏ *</label>
                <select id="status" name="status" required>
                    <option value="active" selected>–ê–∫—Ç–∏–≤–Ω–∞</option>
                    <option value="pending">–í –æ–∂–∏–¥–∞–Ω–∏–∏</option>
                    <option value="cancelled">–û—Ç–º–µ–Ω–µ–Ω–∞</option>
                </select>
            </div>
        </div>
        
        <div class="form-group">
            <h3>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤—ã–±—Ä–∞–Ω–Ω–æ–º –ø–ª–∞–Ω–µ</h3>
            <div style="background: #f0f4f8; padding: 15px; border-radius: 8px; margin-top: 10px;">
                <div id="plan_info" style="color: #718096;">
                    –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∞—Ä–∏—Ñ–Ω—ã–π –ø–ª–∞–Ω –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
                </div>
            </div>
        </div>
        
        <div class="form-group">
            <button type="submit" class="btn btn-success">üéÅ –í—ã–¥–∞—Ç—å –ø–æ–¥–ø–∏—Å–∫—É</button>
            <a href="{% url 'admin_user_subscriptions' %}" class="btn" style="background: #a0aec0; margin-left: 10px;">–û—Ç–º–µ–Ω–∞</a>
        </div>
    </form>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const planSelect = document.getElementById('plan_id');
    const planInfo = document.getElementById('plan_info');
    const startDateInput = document.getElementById('start_date');
    const statusSelect = document.getElementById('status');
    
    if (!startDateInput.value) {
        const today = new Date().toISOString().split('T')[0];
        startDateInput.value = today;
    }
    
    function updatePlanInfo() {
        const selectedPlan = planSelect.options[planSelect.selectedIndex];
        const price = selectedPlan.dataset.price || '0.00';
        const period = selectedPlan.dataset.period || '1';
        
        if (planSelect.value) {
            const startDate = startDateInput.value;
            let endDate = '‚Äî';
            
            if (startDate) {
                const start = new Date(startDate);
                const end = new Date(start);
                end.setMonth(end.getMonth() + parseInt(period));
                endDate = end.toISOString().split('T')[0];
            }
            
            planInfo.innerHTML = `
                <strong>–ù–∞–∑–≤–∞–Ω–∏–µ:</strong> ${selectedPlan.text}<br>
                <strong>–ü–µ—Ä–∏–æ–¥:</strong> ${period} –º–µ—Å—è—Ü–µ–≤<br>
                <strong>–°—Ç–æ–∏–º–æ—Å—Ç—å:</strong> ${price} ‚ÇΩ<br>
                <strong>–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞:</strong> ${startDate || '—Å–µ–≥–æ–¥–Ω—è'}<br>
                <strong>–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è:</strong> ${endDate}<br>
                <strong>–°—Ç–∞—Ç—É—Å:</strong> ${statusSelect.options[statusSelect.selectedIndex].text}
            `;
        } else {
            planInfo.textContent = '–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∞—Ä–∏—Ñ–Ω—ã–π –ø–ª–∞–Ω –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏';
        }
    }
    
    planSelect.addEventListener('change', updatePlanInfo);
    startDateInput.addEventListener('change', updatePlanInfo);
    statusSelect.addEventListener('change', updatePlanInfo);
    
    updatePlanInfo();
});
</script>
{% endblock %}