{% extends 'employees/admin/admin_base.html' %}

{% block title %}–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º–∏{% endblock %}
{% block page_title %}‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞: {{ employee.full_name }}{% endblock %}

{% block admin_nav %}
{{ block.super }}
<a href="{% url 'admin_users_list' %}" 
   {% if request.resolver_match.url_name == 'admin_users_list' %}class="active"{% endif %}>
   üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
</a>
<a href="{% url 'admin_employees_list' %}" 
   {% if request.resolver_match.url_name == 'admin_employees_list' %}class="active"{% endif %}>
   üë®‚Äçüíº –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏
</a>
{% endblock %}

{% block content %}
<div class="content-box">
    <h2>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞: {{ employee.full_name }}</h2>
    
    {% if messages %}
    <div class="alert alert-info">
        {% for message in messages %}
        {{ message }}
        {% endfor %}
    </div>
    {% endif %}
    
    <form method="post" style="max-width: 800px;">
        {% csrf_token %}
        
        <div class="form-row">
            <div class="form-group">
                <label for="full_name">–§–ò–û *</label>
                <input type="text" id="full_name" name="full_name" required 
                       value="{{ employee.full_name }}">
                <div style="font-size: 12px; color: #718096;">
                    –ü–æ–ª–Ω–æ–µ –∏–º—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
                </div>
            </div>
            
            <div class="form-group">
                <label for="email">Email *</label>
                <input type="email" id="email" name="email" required 
                       value="{{ employee.email }}">
                <div style="font-size: 12px; color: #718096;">
                    –†–∞–±–æ—á–∏–π email —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
                </div>
            </div>
        </div>
        
        <div class="form-group">
            <label for="password">–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å (–æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º, –µ—Å–ª–∏ –Ω–µ –Ω—É–∂–Ω–æ –º–µ–Ω—è—Ç—å)</label>
            <input type="password" id="password" name="password" 
                   placeholder="–ú–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤">
            <div style="font-size: 12px; color: #718096;">
                –ï—Å–ª–∏ —É–∫–∞–∑–∞—Ç—å –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å, —Å—Ç–∞—Ä—ã–π –±—É–¥–µ—Ç –∑–∞–º–µ–Ω—ë–Ω
            </div>
        </div>
        
        <div class="form-group">
            <label>–†–æ–ª–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ *</label>
            <div style="background: #f7fafc; padding: 15px; border-radius: 8px; margin-top: 10px;">
                {% for role in all_roles %}
                <div class="checkbox-group" style="margin-bottom: 8px;">
                    <input type="checkbox" id="role_{{ role.0 }}" name="roles" value="{{ role.0 }}"
                           {% if role.0 in employee_roles %}checked{% endif %}>
                    <label for="role_{{ role.0 }}">
                        <span style="font-weight: bold;">{{ role.1 }}</span> - {{ role.2 }}
                    </label>
                </div>
                {% endfor %}
            </div>
            <div style="font-size: 12px; color: #718096; margin-top: 5px;">
                <strong>–í–Ω–∏–º–∞–Ω–∏–µ:</strong> –ü—Ä–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–∏ —Ä–æ–ª–∏ ADMIN —Å–æ—Ç—Ä—É–¥–Ω–∏–∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–∏—Ç –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º—É –∫–æ–Ω—Ç–µ–Ω—Ç—É
            </div>
        </div>
        
        <div class="form-group">
            <label class="checkbox-group">
                <input type="checkbox" id="is_active" name="is_active" 
                       {% if employee.is_active %}checked{% endif %}>
                <span>–ê–∫—Ç–∏–≤–Ω—ã–π —Å–æ—Ç—Ä—É–¥–Ω–∏–∫</span>
            </label>
            <div style="font-size: 12px; color: #718096; margin-top: 5px;">
                –ù–µ–∞–∫—Ç–∏–≤–Ω—ã–π —Å–æ—Ç—Ä—É–¥–Ω–∏–∫ –Ω–µ —Å–º–æ–∂–µ—Ç –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É
            </div>
        </div>
        
        <div class="form-group" style="margin-top: 30px;">
            <button type="submit" class="btn btn-success">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
            <a href="{% url 'admin_employees_list' %}" class="btn" style="background: #a0aec0; margin-left: 10px;">–û—Ç–º–µ–Ω–∞</a>
            
            {% if employee.id != request.session.employee_id %}
            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button type="button" onclick="showResetPasswordModal()" class="btn" style="background: #ed8936;">
                    üîÑ –°–±—Ä–æ—Å–∏—Ç—å –ø–∞—Ä–æ–ª—å
                </button>
                
                <button type="button" onclick="showDeleteModal()" class="btn btn-danger">
                    üóëÔ∏è –£–¥–∞–ª–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
                </button>
            </div>
            {% else %}
            <div style="margin-top: 20px; padding: 10px; background: #fffaf0; border: 1px solid #fbd38d; border-radius: 6px;">
                <strong>‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ:</strong> –í—ã —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ—Ç–µ —Å–≤–æ–π —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å. 
                –í—ã –Ω–µ –º–æ–∂–µ—Ç–µ –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –∏–ª–∏ —É–¥–∞–ª–∏—Ç—å —Å–∞–º–æ–≥–æ —Å–µ–±—è.
            </div>
            {% endif %}
        </div>
    </form>
</div>

<div id="resetPasswordModal" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 500px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h3 style="margin: 0;">–°–±—Ä–æ—Å –ø–∞—Ä–æ–ª—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</h3>
            <button type="button" onclick="closeModal('resetPasswordModal')" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #718096;">&times;</button>
        </div>
        
        <div style="margin-bottom: 20px;">
            <p>–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Å–±—Ä–æ—Å–∏—Ç—å –ø–∞—Ä–æ–ª—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ <strong>{{ employee.full_name }}</strong> ({{ employee.email }})?</p>
            <p style="color: #718096; font-size: 14px;">
                –ü–æ—Å–ª–µ —Å–±—Ä–æ—Å–∞ –±—É–¥–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –Ω–æ–≤—ã–π —Å–ª—É—á–∞–π–Ω—ã–π –ø–∞—Ä–æ–ª—å, –∫–æ—Ç–æ—Ä—ã–π –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç —Å–æ–æ–±—â–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫—É.
            </p>
        </div>
        
        <div style="display: flex; gap: 10px;">
            <form method="post" action="{% url 'admin_employee_reset_password' employee.id %}" style="flex: 1;">
                {% csrf_token %}
                <button type="submit" class="btn btn-danger" style="width: 100%;">–î–∞, —Å–±—Ä–æ—Å–∏—Ç—å –ø–∞—Ä–æ–ª—å</button>
            </form>
            <button type="button" onclick="closeModal('resetPasswordModal')" class="btn" 
                    style="background: #a0aec0; flex: 1;">–û—Ç–º–µ–Ω–∞</button>
        </div>
    </div>
</div>

<div id="deleteModal" class="modal" style="display: none;">
    <div class="modal-content" style="max-width: 500px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h3 style="margin: 0;">–£–¥–∞–ª–µ–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</h3>
            <button type="button" onclick="closeModal('deleteModal')" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #718096;">&times;</button>
        </div>
        
        <div style="margin-bottom: 20px;">
            <p style="color: #e53e3e; font-weight: bold;">‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï!</p>
            <p>–í—ã —Å–æ–±–∏—Ä–∞–µ—Ç–µ—Å—å —É–¥–∞–ª–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ <strong>{{ employee.full_name }}</strong> ({{ employee.email }}).</p>
            <p style="color: #718096; font-size: 14px;">
                –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å. –í—Å–µ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã –∏–∑ —Å–∏—Å—Ç–µ–º—ã.
            </p>
        </div>
        
        <div style="display: flex; gap: 10px;">
            <form method="post" action="{% url 'admin_employee_delete' employee.id %}" style="flex: 1;">
                {% csrf_token %}
                <button type="submit" class="btn btn-danger" style="width: 100%;">–î–∞, —É–¥–∞–ª–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</button>
            </form>
            <button type="button" onclick="closeModal('deleteModal')" class="btn" 
                    style="background: #a0aec0; flex: 1;">–û—Ç–º–µ–Ω–∞</button>
        </div>
    </div>
</div>

<style>
.modal {
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.5);
    display: flex;
    align-items: center;
    justify-content: center;
}

.modal-content {
    background: white;
    padding: 25px;
    border-radius: 10px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.2);
}

.checkbox-group {
    display: flex;
    align-items: center;
    gap: 10px;
    cursor: pointer;
}

.checkbox-group input[type="checkbox"] {
    width: auto;
    margin: 0;
}

.alert {
    padding: 12px 16px;
    border-radius: 6px;
    margin-bottom: 20px;
}

.alert-info {
    background-color: #e6fffa;
    border: 1px solid #81e6d9;
    color: #234e52;
}
</style>

<script>
function showResetPasswordModal() {
    document.getElementById('resetPasswordModal').style.display = 'flex';
}

function showDeleteModal() {
    document.getElementById('deleteModal').style.display = 'flex';
}

function closeModal(modalId) {
    document.getElementById(modalId).style.display = 'none';
}

document.addEventListener('DOMContentLoaded', function() {
    window.onclick = function(event) {
        const resetModal = document.getElementById('resetPasswordModal');
        const deleteModal = document.getElementById('deleteModal');
        
        if (event.target == resetModal) {
            closeModal('resetPasswordModal');
        }
        if (event.target == deleteModal) {
            closeModal('deleteModal');
        }
    }
    
    document.addEventListener('keydown', function(event) {
        if (event.key === 'Escape') {
            closeModal('resetPasswordModal');
            closeModal('deleteModal');
        }
    });
    
    const form = document.querySelector('form');
    form.addEventListener('submit', function(event) {
        const roleCheckboxes = document.querySelectorAll('input[name="roles"]:checked');
        if (roleCheckboxes.length === 0) {
            alert('–í—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É —Ä–æ–ª—å –¥–ª—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞!');
            event.preventDefault();
            return false;
        }
        
        const passwordInput = document.getElementById('password');
        if (passwordInput.value && passwordInput.value.length < 6) {
            alert('–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤!');
            event.preventDefault();
            return false;
        }
        
        return true;
    });
});
</script>
{% endblock %}